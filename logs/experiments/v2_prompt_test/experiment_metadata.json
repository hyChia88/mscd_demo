{
  "experiment_name": "v2_prompt_test",
  "timestamp": "2026-02-11T01:59:55.721467",
  "config": {
    "description": "V2 constraints-driven pipeline across all conditions (A1-C3)",
    "profile": "v2_prompt",
    "conditions": [
      "A1",
      "A2",
      "A3",
      "B1",
      "B2",
      "B3",
      "C1",
      "C2",
      "C3"
    ],
    "cases": "../data_curation/datasets/synth_v0.2/cases_v2.jsonl",
    "output_dir": "logs/experiments/v2_prompt_test",
    "tags": [
      "v2",
      "comparison",
      "comprehensive"
    ],
    "git_ref": null
  },
  "git": {
    "commit": "efa846074eba6dfa781ae0d8565540183e8b96a6",
    "branch": "main",
    "has_uncommitted_changes": true,
    "diff": "diff --git a/README.md b/README.md\nindex 0a78015..914e7e2 100644\n--- a/README.md\n+++ b/README.md\n@@ -359,6 +359,9 @@ See [experiments.yaml](experiments.yaml) for full configuration.\n \n ## Architecture\n \n+**Code Organization Note:**\n+V1 components are at `src/` root level (e.g., `main_mcp.py`, `mcp_langchain_adapter.py`), while V2 components are in `src/v2/` subdirectory. This asymmetry exists for historical reasons (V1 developed first, V2 added later). Shared components (`eval/`, `visual/`, `ifc_engine.py`) work for both pipelines. Both produce compatible `EvalTrace` output, enabling unified visualization and comparison.\n+\n ### V2 Pipeline (Constraints-Driven)\n \n ```\n@@ -426,20 +429,23 @@ mscd_demo/\n \u2502   \u2514\u2500\u2500 tool_descriptions.yaml   # MCP tool descriptions\n \u2502\n \u251c\u2500\u2500 src/\n-\u2502   \u251c\u2500\u2500 main_mcp.py              # V1 entry point (MCP agent)\n-\u2502   \u251c\u2500\u2500 chat_cli.py              # Interactive chat CLI\n-\u2502   \u251c\u2500\u2500 ifc_engine.py            # Core IFC processing engine\n-\u2502   \u251c\u2500\u2500 pipeline_base.py         # Pipeline abstraction (V1Pipeline, V2Pipeline)\n-\u2502   \u251c\u2500\u2500 mcp_langchain_adapter.py # MCP to LangChain adapter\n+\u2502   \u251c\u2500\u2500 # V1 Components (at root level - historical)\n+\u2502   \u251c\u2500\u2500 main_mcp.py              # [V1] Entry point (MCP agent)\n+\u2502   \u251c\u2500\u2500 mcp_langchain_adapter.py # [V1] MCP to LangChain adapter\n+\u2502   \u251c\u2500\u2500 chat_cli.py              # [V1] Interactive chat CLI\n+\u2502   \u2502\n+\u2502   \u251c\u2500\u2500 # Shared Infrastructure\n+\u2502   \u251c\u2500\u2500 pipeline_base.py         # [SHARED] Pipeline abstraction (V1Pipeline, V2Pipeline)\n+\u2502   \u251c\u2500\u2500 ifc_engine.py            # [SHARED] Core IFC processing engine\n \u2502   \u2502\n-\u2502   \u251c\u2500\u2500 common/                  # Shared utilities (single source of truth)\n+\u2502   \u251c\u2500\u2500 common/                  # [SHARED] Utilities (config, GUID extraction, etc.)\n \u2502   \u2502   \u251c\u2500\u2500 config.py            # Config loading, system prompt, LLM init\n \u2502   \u2502   \u251c\u2500\u2500 evaluation.py        # Context formatting, evaluation helpers\n \u2502   \u2502   \u251c\u2500\u2500 guid.py              # IFC GUID extraction (regex)\n \u2502   \u2502   \u251c\u2500\u2500 response_parser.py   # LangGraph response parsing\n \u2502   \u2502   \u2514\u2500\u2500 mcp.py               # MCP connection helper (async context manager)\n \u2502   \u2502\n-\u2502   \u251c\u2500\u2500 v2/                      # V2 constraints-driven pipeline\n+\u2502   \u251c\u2500\u2500 v2/                      # [V2] Constraints-driven pipeline (isolated)\n \u2502   \u2502   \u251c\u2500\u2500 types.py             # Data models (Constraints, QueryPlan, V2Trace)\n \u2502   \u2502   \u251c\u2500\u2500 condition_mask.py    # A1-C3 input masking\n \u2502   \u2502   \u251c\u2500\u2500 constraints_extractor_prompt_only.py  # LLM-based extraction\n@@ -449,24 +455,24 @@ mscd_demo/\n \u2502   \u2502   \u251c\u2500\u2500 pipeline.py          # V2 pipeline orchestration\n \u2502   \u2502   \u2514\u2500\u2500 metrics_v2.py        # V2 diagnostic metrics\n \u2502   \u2502\n-\u2502   \u251c\u2500\u2500 eval/                    # Evaluation framework\n-\u2502   \u2502   \u251c\u2500\u2500 contracts.py         # Pydantic data models\n+\u2502   \u251c\u2500\u2500 eval/                    # [SHARED] Evaluation framework (works for V1 & V2)\n+\u2502   \u2502   \u251c\u2500\u2500 contracts.py         # EvalTrace, ScenarioInput (shared contracts)\n \u2502   \u2502   \u251c\u2500\u2500 metrics.py           # Metric functions\n \u2502   \u2502   \u251c\u2500\u2500 runner.py            # V1 scenario runner\n-\u2502   \u2502   \u2514\u2500\u2500 visualizations.py    # Plot generators (6 chart types)\n+\u2502   \u2502   \u2514\u2500\u2500 visualizations.py    # Plot generators (6 chart types, works for both)\n \u2502   \u2502\n-\u2502   \u251c\u2500\u2500 rq2_schema/              # RQ2 schema validation\n+\u2502   \u251c\u2500\u2500 rq2_schema/              # [SHARED] RQ2 schema validation\n \u2502   \u2502   \u251c\u2500\u2500 extract_final_json.py\n \u2502   \u2502   \u251c\u2500\u2500 schema_registry.py\n \u2502   \u2502   \u251c\u2500\u2500 mapping.py\n \u2502   \u2502   \u251c\u2500\u2500 validators.py\n \u2502   \u2502   \u2514\u2500\u2500 pipeline.py\n \u2502   \u2502\n-\u2502   \u251c\u2500\u2500 visual/                  # Visual analysis modules\n+\u2502   \u251c\u2500\u2500 visual/                  # [SHARED] Visual analysis modules\n \u2502   \u2502   \u251c\u2500\u2500 image_parser.py      # VLM-based image parsing (cached descriptions)\n \u2502   \u2502   \u2514\u2500\u2500 aligner.py           # CLIP-based image-to-element matching\n \u2502   \u2502\n-\u2502   \u2514\u2500\u2500 handoff/                 # BCF issue generation\n+\u2502   \u2514\u2500\u2500 handoff/                 # [SHARED] BCF issue generation\n \u2502       \u251c\u2500\u2500 trace.py             # Trace builder + shared title/description helpers\n \u2502       \u251c\u2500\u2500 bcf_lite.py          # JSON issue output\n \u2502       \u2514\u2500\u2500 bcf_zip.py           # BCF 2.1 zip generation\ndiff --git a/experiments.yaml b/experiments.yaml\nindex 056e815..4d89012 100644\n--- a/experiments.yaml\n+++ b/experiments.yaml\n@@ -62,6 +62,36 @@ experiments:\n     tags: [debug, quick]\n     git_ref: null\n \n+  # Quick test with percentage sampling\n+  quick_test_40pct:\n+    description: \"Quick test with 40% of dataset (scales with dataset size)\"\n+    profile: v2_prompt\n+    conditions: [A1, A2, A3, B1, B2, B3, C1, C2, C3]\n+    cases: ../data_curation/datasets/synth_v0.2/cases_v2.jsonl\n+    output_dir: logs/experiments/quick_test_40pct\n+    percent: 40  # Use 40% of data\n+    tags: [debug, quick, percentage]\n+    git_ref: null\n+\n+  # V1 vs V2 comparison experiments (ALL 9 CONDITIONS)\n+  v1_baseline_test:\n+    description: \"V1 agent-driven pipeline across all conditions (A1-C3)\"\n+    profile: v1_baseline\n+    conditions: [A1, A2, A3, B1, B2, B3, C1, C2, C3]\n+    cases: ../data_curation/datasets/synth_v0.2/cases_v2.jsonl\n+    output_dir: logs/experiments/v1_baseline_test\n+    tags: [v1, baseline, comparison, comprehensive]\n+    git_ref: null\n+\n+  v2_prompt_test:\n+    description: \"V2 constraints-driven pipeline across all conditions (A1-C3)\"\n+    profile: v2_prompt\n+    conditions: [A1, A2, A3, B1, B2, B3, C1, C2, C3]\n+    cases: ../data_curation/datasets/synth_v0.2/cases_v2.jsonl\n+    output_dir: logs/experiments/v2_prompt_test\n+    tags: [v2, comparison, comprehensive]\n+    git_ref: null\n+\n # Comparison groups - define which experiments to compare\n comparisons:\n   vlm_impact:\n@@ -75,6 +105,12 @@ comparisons:\n     experiments: [ablation_images_only, ablation_floorplan_only]\n     output_dir: logs/comparisons/ablation\n \n+  v1_vs_v2:\n+    description: \"V1 Agent-Driven vs V2 Constraints-Driven Pipeline Comparison\"\n+    before: v1_baseline_test\n+    after: v2_prompt_test\n+    output_dir: logs/comparisons/v1_vs_v2\n+\n # Metadata tracking\n tracking:\n   log_git_info: true      # Record git commit, branch, diff\ndiff --git a/logs/experiments/registry.jsonl b/logs/experiments/registry.jsonl\nindex 871d4c1..d2c0e7c 100644\n--- a/logs/experiments/registry.jsonl\n+++ b/logs/experiments/registry.jsonl\n@@ -1 +1,5 @@\n {\"experiment_name\": \"quick_test\", \"timestamp\": \"2026-02-10T19:40:20.394035\", \"output_dir\": \"logs/experiments/quick_test\", \"profile\": \"v2_prompt\", \"conditions\": [\"B1\"], \"tags\": [\"debug\", \"quick\"], \"git_commit\": \"60d1dd96\"}\n+{\"experiment_name\": \"v1_baseline_test\", \"timestamp\": \"2026-02-11T01:07:24.435523\", \"output_dir\": \"logs/experiments/v1_baseline_test\", \"profile\": \"v1_baseline\", \"conditions\": [\"A1\", \"B1\", \"C1\"], \"tags\": [\"v1\", \"baseline\", \"comparison\"], \"git_commit\": \"efa84607\"}\n+{\"experiment_name\": \"v2_prompt_test\", \"timestamp\": \"2026-02-11T01:09:30.614057\", \"output_dir\": \"logs/experiments/v2_prompt_test\", \"profile\": \"v2_prompt\", \"conditions\": [\"A1\", \"B1\", \"C1\"], \"tags\": [\"v2\", \"comparison\"], \"git_commit\": \"efa84607\"}\n+{\"experiment_name\": \"quick_test_40pct\", \"timestamp\": \"2026-02-11T01:42:29.405913\", \"output_dir\": \"logs/experiments/quick_test_40pct\", \"profile\": \"v2_prompt\", \"conditions\": [\"A1\", \"A2\", \"A3\", \"B1\", \"B2\", \"B3\", \"C1\", \"C2\", \"C3\"], \"tags\": [\"debug\", \"quick\", \"percentage\"], \"git_commit\": \"efa84607\"}\n+{\"experiment_name\": \"v1_baseline_test\", \"timestamp\": \"2026-02-11T01:55:34.604010\", \"output_dir\": \"logs/experiments/v1_baseline_test\", \"profile\": \"v1_baseline\", \"conditions\": [\"A1\", \"A2\", \"A3\", \"B1\", \"B2\", \"B3\", \"C1\", \"C2\", \"C3\"], \"tags\": [\"v1\", \"baseline\", \"comparison\", \"comprehensive\"], \"git_commit\": \"efa84607\"}\ndiff --git a/script/experiment.py b/script/experiment.py\nindex d2768df..55a4998 100755\n--- a/script/experiment.py\n+++ b/script/experiment.py\n@@ -195,7 +195,9 @@ class ExperimentManager:\n                 \"--output_dir\", str(output_dir)\n             ]\n \n-            if \"limit\" in config:\n+            if \"percent\" in config:\n+                cmd.extend([\"--percent\", str(config[\"percent\"])])\n+            elif \"limit\" in config:\n                 cmd.extend([\"--limit\", str(config[\"limit\"])])\n \n             if dry_run:\ndiff --git a/script/run.py b/script/run.py\nindex 780b756..4ef90b9 100644\n--- a/script/run.py\n+++ b/script/run.py\n@@ -77,6 +77,7 @@ def write_csv_summary(\n     v2_summary: Optional[Dict[str, Any]],\n     v2_per_case: Optional[List[Dict[str, Any]]],\n     path: Path,\n+    percent_used: float = 100.0,\n ) -> None:\n     \"\"\"Write combined v1 + v2 metrics CSV.\"\"\"\n     path.parent.mkdir(parents=True, exist_ok=True)\n@@ -87,6 +88,7 @@ def write_csv_summary(\n         # \u2500\u2500 Section 1: overall v1 metrics \u2500\u2500\n         w.writerow([\"=== OVERALL METRICS ===\"])\n         w.writerow([\"Metric\", \"Value\"])\n+        w.writerow([\"Dataset Coverage\", f\"{percent_used:.1f}%\"])\n         w.writerow([\"Total Scenarios\", v1_summary.total_scenarios])\n         w.writerow([\"Successful Runs\", v1_summary.successful_runs])\n         w.writerow([\"Top-1 Accuracy\", f\"{v1_summary.top1_accuracy:.4f}\"])\n@@ -203,10 +205,24 @@ async def main(args: argparse.Namespace) -> None:\n     else:\n         print(f\"Loaded {len(cases)} cases (all conditions)\")\n \n-    # Apply limit if specified\n-    if args.limit is not None and args.limit > 0:\n+    # Apply percentage or limit if specified\n+    total_cases_after_filter = len(cases)\n+    percent_used = 100.0  # Default: use 100% of data\n+\n+    if args.percent is not None and 0 < args.percent <= 100:\n+        # Percentage mode (overrides --limit)\n+        limit = max(1, int(total_cases_after_filter * args.percent / 100))\n+        cases = cases[:limit]\n+        percent_used = args.percent\n+        print(f\"Using {args.percent:.1f}% of data: {len(cases)}/{total_cases_after_filter} cases\")\n+    elif args.limit is not None and args.limit > 0:\n+        # Absolute limit mode\n         cases = cases[:args.limit]\n-        print(f\"Limited to first {len(cases)} cases\")\n+        percent_used = (len(cases) / total_cases_after_filter * 100) if total_cases_after_filter > 0 else 100\n+        print(f\"Limited to first {len(cases)} cases ({percent_used:.1f}% of filtered data)\")\n+    else:\n+        # Full dataset (100%)\n+        print(f\"Using full dataset: {len(cases)} cases (100%)\")\n \n     if not cases:\n         print(\"No cases matched \u2014 exiting.\")\n@@ -332,7 +348,7 @@ async def main(args: argparse.Namespace) -> None:\n     summary_file = output_dir / f\"summary_{tag}.csv\"\n \n     write_jsonl(valid_traces, traces_file)\n-    write_csv_summary(v1_summary, v2_summary, v2_per_case_metrics or None, summary_file)\n+    write_csv_summary(v1_summary, v2_summary, v2_per_case_metrics or None, summary_file, percent_used)\n \n     # \u2500\u2500 8. print quick summary \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n     print()\n@@ -394,6 +410,10 @@ def cli() -> argparse.Namespace:\n         \"--limit\", type=int, default=None,\n         help=\"Limit to first N cases (for quick testing)\",\n     )\n+    p.add_argument(\n+        \"--percent\", type=float, default=None,\n+        help=\"Run on X%% of dataset (e.g., --percent 40 for 40%%). Overrides --limit.\",\n+    )\n     return p.parse_args()\n \n \ndiff --git a/src/common/__pycache__/config.cpython-310.pyc b/src/common/__pycache__/config.cpython-310.pyc\nindex 61dda94..140083c 100644\nBinary files a/src/common/__pycache__/config.cpython-310.pyc and b/src/common/__pycache__/config.cpython-310.pyc differ\ndiff --git a/src/common/__pycache__/evaluation.cpython-310.pyc b/src/common/__pycache__/evaluation.cpython-310.pyc\nindex 58cd478..eb1de08 100644\nBinary files a/src/common/__pycache__/evaluation.cpython-310.pyc and b/src/common/__pycache__/evaluation.cpython-310.pyc differ\ndiff --git a/src/eval/__init__.py b/src/eval/__init__.py\nindex 14a5039..e5aad9f 100644\n--- a/src/eval/__init__.py\n+++ b/src/eval/__init__.py\n@@ -35,6 +35,7 @@ from .visualizations import (\n     plot_image_parse_timing,\n     plot_vision_impact,\n     plot_per_case_heatmap,\n+    plot_condition_wise_comparison,\n     generate_all_plots,\n )\n \n@@ -69,5 +70,6 @@ __all__ = [\n     \"plot_image_parse_timing\",\n     \"plot_vision_impact\",\n     \"plot_per_case_heatmap\",\n+    \"plot_condition_wise_comparison\",\n     \"generate_all_plots\",\n ]\ndiff --git a/src/eval/__pycache__/__init__.cpython-310.pyc b/src/eval/__pycache__/__init__.cpython-310.pyc\nindex ff93fab..a4da830 100644\nBinary files a/src/eval/__pycache__/__init__.cpython-310.pyc and b/src/eval/__pycache__/__init__.cpython-310.pyc differ\ndiff --git a/src/eval/__pycache__/runner.cpython-310.pyc b/src/eval/__pycache__/runner.cpython-310.pyc\nindex c61bc79..df1ffce 100644\nBinary files a/src/eval/__pycache__/runner.cpython-310.pyc and b/src/eval/__pycache__/runner.cpython-310.pyc differ\ndiff --git a/src/eval/__pycache__/visualizations.cpython-310.pyc b/src/eval/__pycache__/visualizations.cpython-310.pyc\nindex 80df97a..bc2ca36 100644\nBinary files a/src/eval/__pycache__/visualizations.cpython-310.pyc and b/src/eval/__pycache__/visualizations.cpython-310.pyc differ\ndiff --git a/src/eval/visualizations.py b/src/eval/visualizations.py\nindex 23240e0..2d530fb 100644\n--- a/src/eval/visualizations.py\n+++ b/src/eval/visualizations.py\n@@ -389,6 +389,134 @@ def plot_per_case_heatmap(\n     plt.close()\n \n \n+# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n+# Chart 7: Condition-Wise Performance Matrix (A1-C3)\n+# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n+\n+def plot_condition_wise_comparison(\n+    experiments: Dict[str, List[Dict[str, Any]]],\n+    output_path: str,\n+    title: str = \"Performance Across Experimental Conditions (A1-C3)\"\n+):\n+    \"\"\"\n+    **KEY THESIS FIGURE**: General condition-wise comparison across experiments.\n+\n+    Compares any number of experiments (v1, v2, v3, baseline, etc.) across\n+    all 9 experimental conditions showing modality impact.\n+\n+    Args:\n+        experiments: Dict mapping experiment_name \u2192 list of traces\n+        output_path: Where to save the plot\n+        title: Chart title\n+    \"\"\"\n+    print(f\"\\n\u2192 Generating Condition-Wise Comparison...\")\n+\n+    conditions = [\"A1\", \"A2\", \"A3\", \"B1\", \"B2\", \"B3\", \"C1\", \"C2\", \"C3\"]\n+    exp_names = list(experiments.keys())\n+\n+    # Calculate accuracy for each experiment \u00d7 condition\n+    data = []\n+    for exp_name in exp_names:\n+        traces = experiments[exp_name]\n+\n+        # Group by condition\n+        by_condition = {}\n+        for trace in traces:\n+            cond = trace.get(\"scenario\", {}).get(\"bench\", {}).get(\"condition\", \"Unknown\")\n+            if cond not in by_condition:\n+                by_condition[cond] = []\n+            by_condition[cond].append(trace)\n+\n+        # Calculate accuracy per condition\n+        for cond in conditions:\n+            hits = sum(1 for t in by_condition.get(cond, []) if t.get(\"guid_match\", False))\n+            total = len(by_condition.get(cond, []))\n+            acc = (hits / total * 100) if total > 0 else 0\n+            data.append({\n+                'Experiment': exp_name,\n+                'Condition': cond,\n+                'Accuracy': acc,\n+                'Count': total\n+            })\n+\n+    if not data:\n+        print(\"\u26a0\ufe0f  No data available for comparison\")\n+        return\n+\n+    df = pd.DataFrame(data)\n+\n+    # Create grouped bar chart\n+    fig, ax = plt.subplots(figsize=(16, 9))\n+\n+    # Use different colors for each experiment\n+    colors = ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c']\n+    x = np.arange(len(conditions))\n+    n_exp = len(exp_names)\n+    width = 0.8 / n_exp  # Dynamic bar width\n+\n+    for i, exp_name in enumerate(exp_names):\n+        exp_data = df[df['Experiment'] == exp_name]\n+        accuracies = [exp_data[exp_data['Condition'] == c]['Accuracy'].values[0]\n+                     if len(exp_data[exp_data['Condition'] == c]) > 0 else 0\n+                     for c in conditions]\n+\n+        offset = (i - n_exp/2 + 0.5) * width\n+        bars = ax.bar(x + offset, accuracies, width,\n+                     label=exp_name,\n+                     color=colors[i % len(colors)],\n+                     alpha=0.85,\n+                     edgecolor='black',\n+                     linewidth=1.2)\n+\n+        # Add value labels on bars\n+        for bar in bars:\n+            height = bar.get_height()\n+            if height > 0:\n+                ax.text(bar.get_x() + bar.get_width()/2., height + 1,\n+                       f'{height:.0f}%',\n+                       ha='center', va='bottom',\n+                       fontsize=8, fontweight='bold')\n+\n+    # Customize plot\n+    ax.set_xlabel('Experimental Condition', fontsize=14, fontweight='bold')\n+    ax.set_ylabel('Top-1 Accuracy (%)', fontsize=14, fontweight='bold')\n+    ax.set_title(title, fontsize=16, fontweight='bold', pad=20)\n+    ax.set_xticks(x)\n+    ax.set_xticklabels(conditions, fontsize=12, fontweight='bold')\n+    ax.set_ylim(0, 110)\n+    ax.legend(fontsize=11, loc='upper left', frameon=True, shadow=True, ncol=min(3, n_exp))\n+    ax.grid(axis='y', alpha=0.3, linestyle='--')\n+\n+    # Add condition group separators\n+    ax.axvline(x=2.5, color='gray', linestyle='--', alpha=0.6, linewidth=2)\n+    ax.axvline(x=5.5, color='gray', linestyle='--', alpha=0.6, linewidth=2)\n+\n+    # Group labels\n+    ax.text(1, 105, 'Text Only\\n(No Images)', ha='center', fontsize=10,\n+            style='italic', color='gray', bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.3))\n+    ax.text(4, 105, 'Images + Text\\n(No Floorplan)', ha='center', fontsize=10,\n+            style='italic', color='gray', bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.3))\n+    ax.text(7.5, 105, 'Full Multimodal\\n(Images + Floorplan)', ha='center', fontsize=10,\n+            style='italic', color='gray', bbox=dict(boxstyle='round', facecolor='lightyellow', alpha=0.3))\n+\n+    # Add condition details legend\n+    condition_info = (\n+        \"Condition Details:\\n\"\n+        \"A1: \u274cImg \u274cPlan \u274c4D \ud83d\udd35Blur | A2: \u274cImg \u274cPlan \u27054D \ud83d\udfe2Clear | A3: \u274cImg \u274cPlan \u27054D+ \ud83d\udfe2Clear\\n\"\n+        \"B1: \u2705Img \u274cPlan \u274c4D \ud83d\udd35Blur | B2: \u2705Img \u274cPlan \u27054D \ud83d\udfe2Clear | B3: \u2705Img \u274cPlan \u274c4D \ud83d\udfe2Clear\\n\"\n+        \"C1: \u2705Img \u2705Plan \u274c4D \ud83d\udfe2Clear | C2: \u2705Img \u2705Plan \u27054D \ud83d\udfe2Clear | C3: \u2705Img \u2705Plan \u27054D+ \ud83d\udfe2Clear+CLIP\"\n+    )\n+\n+    fig.text(0.5, 0.01, condition_info, ha='center', fontsize=9,\n+            bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.4))\n+\n+    plt.tight_layout(rect=[0, 0.03, 1, 1])\n+    if output_path:\n+        plt.savefig(output_path, dpi=300, bbox_inches='tight')\n+        print(f\"\u2713 Saved: {output_path}\")\n+    plt.close()\n+\n+\n # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n # Main Entry Point\n # \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@@ -444,6 +572,18 @@ def generate_all_plots(\n \n     plot_per_case_heatmap(traces, f\"{output_dir}/6_per_case_heatmap.png\")\n \n+    # Condition-wise comparison (if multiple experiments available)\n+    if before_traces and traces:\n+        # Extract experiment names from traces\n+        main_exp_name = Path(traces_path).stem.replace(\"traces_\", \"\").split(\"_\")[-1] if traces_path else \"Main\"\n+        before_exp_name = Path(before_traces_path).stem.replace(\"traces_\", \"\").split(\"_\")[-1] if before_traces_path else \"Baseline\"\n+\n+        experiments = {\n+            before_exp_name: before_traces,\n+            main_exp_name: traces\n+        }\n+        plot_condition_wise_comparison(experiments, f\"{output_dir}/7_condition_comparison.png\")\n+\n     print(f\"\\n{'='*60}\")\n     print(f\"\u2713 All plots saved to: {output_dir}/\")\n     print(f\"{'='*60}\\n\")\n"
  },
  "conda_env": "name: mscd_demo\nchannels:\n  - defaults\ndependencies:\n  - _libgcc_mutex=0.1=main\n  - _openmp_mutex=5.1=1_gnu\n  - aom=3.12.1=h7934f7d_0\n  - blas=1.0=mkl\n  - bottleneck=1.4.2=py310haa0f9ac_1\n  - bzip2=1.0.8=h5eee18b_6\n  - c-ares=1.34.6=hd44998d_0\n  - ca-certificates=2025.12.2=h06a4308_0\n  - cairo=1.18.4=h44eff21_0\n  - cycler=0.12.1=py310h06a4308_0\n  - cyrus-sasl=2.1.28=h83b0a09_4\n  - dav1d=1.2.1=h5eee18b_0\n  - dbus=1.16.2=h5bd4931_0\n  - expat=2.7.3=h3385a95_0\n  - fontconfig=2.15.0=h2c49b7f_0\n  - fonttools=4.61.0=py310h47b2149_0\n  - freetype=2.14.1=hf5b9546_0\n  - fribidi=1.0.16=h9fb5f84_0\n  - gettext=0.21.0=hedfda30_2\n  - glib=2.86.3=h617169b_0\n  - glib-tools=2.86.3=h9fad118_0\n  - graphite2=1.3.14=h295c915_1\n  - gst-plugins-base=1.14.1=h6a678d5_1\n  - gstreamer=1.14.1=h5eee18b_1\n  - harfbuzz=12.3.0=h79d275a_1\n  - icu=73.1=h6a678d5_0\n  - iniconfig=2.3.0=py310h06a4308_0\n  - intel-openmp=2025.0.0=h06a4308_1171\n  - jansson=2.14=h5eee18b_1\n  - jpeg=9f=h5ce9db8_0\n  - kiwisolver=1.4.9=py310h24d9097_0\n  - krb5=1.20.1=h143b758_1\n  - lcms2=2.17=heab6991_0\n  - ld_impl_linux-64=2.44=h153f514_2\n  - lerc=4.0.0=h6a678d5_0\n  - libabseil=20250127.0=cxx17_h6a678d5_0\n  - libavif=1.3.0=h3539ee5_0\n  - libbrotlicommon=1.2.0=h32cd6e7_0\n  - libbrotlidec=1.2.0=ha2c5f68_0\n  - libbrotlienc=1.2.0=h2e96acb_0\n  - libclang=14.0.6=default_hc6dbbc7_2\n  - libclang13=14.0.6=default_he11475f_2\n  - libcups=2.4.15=hbe4054b_0\n  - libcurl=8.18.0=h3506a8c_0\n  - libdeflate=1.22=h5eee18b_0\n  - libedit=3.1.20230828=h5eee18b_0\n  - libegl=1.7.0=h5eee18b_2\n  - libev=4.33=h7f8727e_1\n  - libevent=2.1.12=hdbd6064_1\n  - libffi=3.4.4=h6a678d5_1\n  - libgcc=15.2.0=h69a1729_7\n  - libgcc-ng=15.2.0=h166f726_7\n  - libgl=1.7.0=h5eee18b_2\n  - libglib=2.86.3=h8b17d9a_0\n  - libglvnd=1.7.0=h5eee18b_2\n  - libglx=1.7.0=h5eee18b_2\n  - libgomp=15.2.0=h4751f2c_7\n  - libhwloc=2.12.1=default_hf1bbc79_1000\n  - libiconv=1.16=h5eee18b_3\n  - libidn2=2.3.8=hf80d704_0\n  - libkrb5=1.22.1=h6d2bf13_0\n  - libllvm14=14.0.6=hecde1de_4\n  - libnghttp2=1.67.1=h697f920_0\n  - libnsl=2.0.0=h5eee18b_0\n  - libopengl=1.7.0=h5eee18b_2\n  - libopenjpeg=2.5.4=hee96239_1\n  - libpng=1.6.54=hee55ce4_0\n  - libpq=17.6=h5ca1609_1\n  - libprotobuf=5.29.3=h3cdef7c_1\n  - libsodium=1.0.20=heac8642_0\n  - libssh2=1.11.1=h251f7ec_0\n  - libstdcxx=15.2.0=h39759b7_7\n  - libstdcxx-ng=15.2.0=hc03a8fd_7\n  - libtiff=4.7.1=h029b1ac_0\n  - libunistring=1.3=hb25bd0a_0\n  - libuuid=1.41.5=h5eee18b_0\n  - libwebp-base=1.6.0=hb7bb969_0\n  - libxcb=1.17.0=h9b100fa_0\n  - libxkbcommon=1.9.1=h69220b7_0\n  - libxml2=2.13.9=h2c43086_0\n  - libzlib=1.3.1=hb25bd0a_0\n  - lmdb=0.9.31=hb25bd0a_0\n  - lz4-c=1.9.4=h6a678d5_1\n  - matplotlib-base=3.10.8=py310h8a257da_0\n  - mkl=2025.0.0=hacee8c2_941\n  - mkl-service=2.5.2=py310hacdc0fc_0\n  - mkl_fft=2.1.1=py310h8fe796d_0\n  - mkl_random=1.3.0=py310h505adc9_0\n  - mysql=8.4.0=h721767e_2\n  - ncurses=6.5=h7934f7d_0\n  - numexpr=2.14.1=py310h41d4191_0\n  - numpy-base=2.2.5=py310he1678cf_2\n  - openldap=2.6.12=hb446bd0_0\n  - openssl=3.0.19=h1b28b03_0\n  - packaging=25.0=py310h06a4308_1\n  - pandas=2.3.3=py310h23c847b_1\n  - pcre2=10.46=hf426167_0\n  - pip=25.3=pyhc872135_0\n  - pixman=0.46.4=h7934f7d_0\n  - pluggy=1.5.0=py310h06a4308_0\n  - pthread-stubs=0.3=h0ce48e5_1\n  - pygments=2.19.2=py310h06a4308_0\n  - pyparsing=3.2.5=py310h06a4308_0\n  - pyqt=5.15.11=py310h144e999_0\n  - pyqt5-sip=12.17.0=py310hee96239_0\n  - pytest=9.0.2=py310h06a4308_0\n  - python=3.10.19=h6fa692b_0\n  - python-dateutil=2.9.0post0=py310h06a4308_2\n  - python-tzdata=2025.3=pyhd3eb1b0_0\n  - pytz=2025.2=py310h06a4308_0\n  - qt-main=5.15.2=hb6262e9_12\n  - readline=8.3=hc2a1206_0\n  - seaborn=0.13.2=py310h06a4308_3\n  - setuptools=80.9.0=py310h06a4308_0\n  - sip=6.12.0=py310h7934f7d_0\n  - six=1.17.0=py310h06a4308_0\n  - sqlite=3.51.0=h2a70700_0\n  - tbb=2022.3.0=h698db13_0\n  - tbb-devel=2022.3.0=h698db13_0\n  - tk=8.6.15=h54e0aa7_0\n  - tomli=2.4.0=py310h06a4308_0\n  - tornado=6.5.4=py310h47b2149_0\n  - typing-extensions=4.15.0=py310h06a4308_0\n  - typing_extensions=4.15.0=py310h06a4308_0\n  - wheel=0.45.1=py310h06a4308_0\n  - xcb-util=0.4.1=h5eee18b_2\n  - xcb-util-image=0.4.0=h5eee18b_2\n  - xcb-util-keysyms=0.4.1=h5eee18b_0\n  - xcb-util-renderutil=0.3.10=h5eee18b_0\n  - xcb-util-wm=0.4.2=h5eee18b_0\n  - xkeyboard-config=2.44=h382ed1a_1\n  - xorg-libice=1.1.2=h9b100fa_0\n  - xorg-libsm=1.2.6=h9b100fa_0\n  - xorg-libx11=1.8.12=h9b100fa_1\n  - xorg-libxau=1.0.12=h9b100fa_0\n  - xorg-libxcomposite=0.4.6=h9b100fa_2\n  - xorg-libxdamage=1.1.6=h9b100fa_0\n  - xorg-libxdmcp=1.1.5=h9b100fa_0\n  - xorg-libxext=1.3.6=h9b100fa_0\n  - xorg-libxfixes=6.0.1=h9b100fa_0\n  - xorg-libxrender=0.9.12=h9b100fa_0\n  - xorg-libxxf86vm=1.1.6=h9b100fa_0\n  - xorg-xorgproto=2024.1=h5eee18b_1\n  - xz=5.6.4=h5eee18b_1\n  - zlib=1.3.1=hb25bd0a_0\n  - zstd=1.5.7=h11fc155_0\n  - pip:\n      - addict==2.4.0\n      - annotated-types==0.7.0\n      - anyio==4.12.0\n      - asttokens==3.0.1\n      - async-timeout==4.0.3\n      - attrs==25.4.0\n      - authlib==1.6.6\n      - backports-tarfile==1.2.0\n      - beartype==0.22.9\n      - blinker==1.9.0\n      - cachetools==6.2.2\n      - certifi==2025.11.12\n      - cffi==2.0.0\n      - charset-normalizer==3.4.4\n      - click==8.3.1\n      - cloudpickle==3.1.2\n      - colorama==0.4.6\n      - comm==0.2.3\n      - configargparse==1.7.1\n      - contourpy==1.3.2\n      - cryptography==46.0.3\n      - cyclopts==4.5.0\n      - dash==3.3.0\n      - decorator==5.2.1\n      - diskcache==5.6.3\n      - distro==1.9.0\n      - dnspython==2.8.0\n      - docstring-parser==0.17.0\n      - docutils==0.22.4\n      - email-validator==2.3.0\n      - exceptiongroup==1.3.1\n      - executing==2.2.1\n      - fakeredis==2.33.0\n      - fastjsonschema==2.21.2\n      - fastmcp==2.14.3\n      - filelock==3.20.0\n      - filetype==1.2.0\n      - flask==3.1.2\n      - fsspec==2025.12.0\n      - google-ai-generativelanguage==0.6.15\n      - google-api-core==2.28.1\n      - google-api-python-client==2.187.0\n      - google-auth==2.48.0\n      - google-auth-httplib2==0.2.1\n      - google-genai==1.62.0\n      - google-generativeai==0.8.5\n      - googleapis-common-protos==1.72.0\n      - greenlet==3.3.0\n      - grpcio==1.76.0\n      - grpcio-status==1.71.2\n      - h11==0.16.0\n      - hf-xet==1.2.0\n      - httpcore==1.0.9\n      - httplib2==0.31.0\n      - httpx==0.28.1\n      - httpx-sse==0.4.3\n      - huggingface-hub==0.36.0\n      - idna==3.11\n      - ifcopenshell==0.8.4\n      - importlib-metadata==8.7.0\n      - interchange==2021.0.4\n      - ipython==8.37.0\n      - ipywidgets==8.1.8\n      - isodate==0.7.2\n      - itsdangerous==2.2.0\n      - jaraco-classes==3.4.0\n      - jaraco-context==6.1.0\n      - jaraco-functools==4.4.0\n      - jedi==0.19.2\n      - jeepney==0.9.0\n      - jinja2==3.1.6\n      - jiter==0.12.0\n      - joblib==1.5.2\n      - jsonpatch==1.33\n      - jsonpointer==3.0.0\n      - jsonschema==4.25.1\n      - jsonschema-path==0.3.4\n      - jsonschema-specifications==2025.9.1\n      - jupyter-core==5.9.1\n      - jupyterlab-widgets==3.0.16\n      - keyring==25.7.0\n      - langchain==0.3.27\n      - langchain-core==0.3.80\n      - langchain-google-genai==2.0.10\n      - langchain-mcp-adapters==0.2.0\n      - langchain-text-splitters==0.3.11\n      - langgraph==1.0.1\n      - langgraph-checkpoint==3.0.1\n      - langgraph-prebuilt==1.0.1\n      - langgraph-sdk==0.2.14\n      - langsmith==0.4.56\n      - lark==1.3.1\n      - lupa==2.6\n      - markdown-it-py==4.0.0\n      - markupsafe==3.0.3\n      - matplotlib==3.10.7\n      - matplotlib-inline==0.2.1\n      - mcp==1.25.0\n      - mdurl==0.1.2\n      - monotonic==1.6\n      - more-itertools==10.8.0\n      - mpmath==1.3.0\n      - narwhals==2.13.0\n      - nbformat==5.10.4\n      - nest-asyncio==1.6.0\n      - networkx==3.4.2\n      - numpy==2.2.6\n      - nvidia-cublas-cu12==12.8.4.1\n      - nvidia-cuda-cupti-cu12==12.8.90\n      - nvidia-cuda-nvrtc-cu12==12.8.93\n      - nvidia-cuda-runtime-cu12==12.8.90\n      - nvidia-cudnn-cu12==9.10.2.21\n      - nvidia-cufft-cu12==11.3.3.83\n      - nvidia-cufile-cu12==1.13.1.3\n      - nvidia-curand-cu12==10.3.9.90\n      - nvidia-cusolver-cu12==11.7.3.90\n      - nvidia-cusparse-cu12==12.5.8.93\n      - nvidia-cusparselt-cu12==0.7.1\n      - nvidia-nccl-cu12==2.27.5\n      - nvidia-nvjitlink-cu12==12.8.93\n      - nvidia-nvshmem-cu12==3.3.20\n      - nvidia-nvtx-cu12==12.8.90\n      - open3d==0.19.0\n      - openai==2.8.1\n      - openapi-pydantic==0.5.1\n      - opentelemetry-api==1.39.1\n      - opentelemetry-exporter-prometheus==0.60b1\n      - opentelemetry-instrumentation==0.60b1\n      - opentelemetry-sdk==1.39.1\n      - opentelemetry-semantic-conventions==0.60b1\n      - orjson==3.11.5\n      - ormsgpack==1.12.0\n      - pansi==2024.11.0\n      - parso==0.8.5\n      - pathable==0.4.4\n      - pathvalidate==3.3.1\n      - pexpect==4.9.0\n      - pillow==12.0.0\n      - platformdirs==4.5.1\n      - plotly==6.5.0\n      - prometheus-client==0.24.1\n      - prompt-toolkit==3.0.52\n      - proto-plus==1.26.1\n      - protobuf==5.29.5\n      - ptyprocess==0.7.0\n      - pure-eval==0.2.3\n      - py-key-value-aio==0.3.0\n      - py-key-value-shared==0.3.0\n      - py2neo==2021.2.4\n      - pyasn1==0.6.1\n      - pyasn1-modules==0.4.2\n      - pycparser==2.23\n      - pydantic==2.12.5\n      - pydantic-core==2.41.5\n      - pydantic-settings==2.12.0\n      - pydocket==0.16.6\n      - pyjwt==2.10.1\n      - pyperclip==1.11.0\n      - pyquaternion==0.9.9\n      - python-dotenv==1.2.1\n      - python-json-logger==4.0.0\n      - python-multipart==0.0.21\n      - pyyaml==6.0.3\n      - redis==7.1.0\n      - referencing==0.36.2\n      - regex==2025.11.3\n      - requests==2.32.5\n      - requests-toolbelt==1.0.0\n      - retrying==1.4.2\n      - rich==14.2.0\n      - rich-rst==1.3.2\n      - rpds-py==0.30.0\n      - rsa==4.9.1\n      - safetensors==0.7.0\n      - scikit-learn==1.7.2\n      - scipy==1.15.3\n      - secretstorage==3.5.0\n      - shapely==2.1.2\n      - shellingham==1.5.4\n      - sniffio==1.3.1\n      - sortedcontainers==2.4.0\n      - sqlalchemy==2.0.44\n      - sse-starlette==3.1.2\n      - stack-data==0.6.3\n      - starlette==0.51.0\n      - sympy==1.14.0\n      - tenacity==9.1.2\n      - threadpoolctl==3.6.0\n      - tokenizers==0.22.1\n      - torch==2.9.1\n      - tqdm==4.67.1\n      - traitlets==5.14.3\n      - transformers==4.57.3\n      - triton==3.5.1\n      - typer==0.21.1\n      - typing-inspection==0.4.2\n      - tzdata==2025.2\n      - uritemplate==4.2.0\n      - urllib3==2.6.0\n      - uuid-utils==0.12.0\n      - uvicorn==0.40.0\n      - wcwidth==0.2.14\n      - websockets==15.0.1\n      - werkzeug==3.1.4\n      - widgetsnbextension==4.0.15\n      - wrapt==1.17.3\n      - xxhash==3.6.0\n      - zipp==3.23.0\n      - zstandard==0.25.0\nprefix: /root/miniconda3/envs/mscd_demo\n"
}